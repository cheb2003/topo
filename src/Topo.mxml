<?xml version="1.0"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:topo1="my.ui.topo.*" creationComplete="fn()" preinitialize="pinit()" > 
    <fx:Script><![CDATA[
		import mx.collections.ArrayCollection;
		import mx.collections.ArrayList;
		
		import my.ui.topo.Link;
		import my.ui.topo.Node;
		import my.ui.topo.data.DataAnalyzer;

		[Bindable]
		public var nodes:ArrayCollection = null;
		[Bindable]
		public var links:ArrayCollection = null;
		
		public function pinit():void
		{
			var nodeStr:String = '[{"name":"testNode1","info":"testNode2","id":"testid1","isBase":"true"},{"name":"testNode2","info":"testNode2","id":"testid2","isBase":"false"},{"name":"testNode3","info":"testNode3","id":"testid3","isBase":"false"},{"name":"testNode4","info":"testNode4","id":"testid4","isBase":"false"},{"name":"testNode5","info":"testNode5","id":"testid5","isBase":"false"},{"name":"testNode6","info":"testNode6","id":"testid6","isBase":"false"},{"name":"testNode7","info":"testNode7","id":"testid7","isBase":"false"},{"name":"testNode8","info":"testNode8","id":"testid8","isBase":"false"},{"name":"testNode9","info":"testNode9","id":"testid9","isBase":"false"},{"name":"testNode10","info":"testNode10","id":"testid10","isBase":"false"}]';
			var linkStr:String = '[{"label":"label1","startNode":"testid1","id":"testid1","endNode":"testid2","linkName":"testLinkName","linkInfo":"testLinkInfo"},{"label":"label2","startNode":"testid1","id":"testid2","endNode":"testid3","linkName":"testLinkName","linkInfo":"testLinkInfo"}]';
			nodes = DataAnalyzer.getNodeList(nodeStr);
			links = DataAnalyzer.getLinkList(linkStr,nodes.toArray());
//			var obj:Object = DataAnalyzer.analayzerData(str);
//			nodes = obj.nodeList as ArrayCollection;
//			links = obj.linkList as ArrayCollection;
			
		}
        public function fn():void{
           topo1.nodeLayout.performLayout();
        }
		
		public function getNodes():ArrayCollection{
			if (nodes!=null)
				return nodes;
			nodes = new ArrayCollection();
			var node:Node = new Node();
//			node.x = 100;
//			node.y = 100;
			nodes.addItem(node);

            var node1:Node = new Node();
//            node1.x = 500;
//            node1.y = 200;
            nodes.addItem(node1);
			
			nodes.addItem(new Node());
			nodes.addItem(new Node());
			nodes.addItem(new Node());
			nodes.addItem(new Node());
			nodes.addItem(new Node());
			nodes.addItem(new Node());
			nodes.addItem(new Node());
			nodes.addItem(new Node());
			
			return nodes;
		}

		public function getLinks():ArrayCollection{
            if(links != null) {
                return links;
            }
			links = new ArrayCollection();
			var link:Link = new Link();
			link.startNode = Node(nodes.getItemAt(0));
			link.endNode = Node(nodes.getItemAt(1));
			links.addItem(link);
			
			var link1:Link = new Link();
			link1.startNode = Node(nodes.getItemAt(1));
			link1.endNode = Node(nodes.getItemAt(2));
			link1.isDirectRelation = true;
			links.addItem(link1);
			return links;
		}

        private function moveGraph(event:MouseEvent):void {
            var x:Number = 20 - event.localX
            var y:Number = 20 - event.localY
//            trace(x + ":" + y)
            if(x < 0) {
                x -= 15 * Math.abs(x/15)
            } else {
                x += 15 * Math.abs(x/15);
            }
            if(y < 0) {
                y -= 15 * Math.abs(y/15)
            } else {
                y += 15 * Math.abs(y/15)
            }
            topo1.moveBy(x, y)
        }
        ]]></fx:Script>

    <topo1:TopoGraph id="topo1" nodeDataProvider="{getNodes()}" linkDataProvider="{getLinks()}" backgroundColor="#ffffff"  width="100%" height="100%"/>

    <s:Image id="minImage" right="200" depth="{int.MAX_VALUE}" click="topo1.zoomOut()" bottom="40" source="{TopoGraph.min2}" useHandCursor="true" buttonMode="true"
            mouseOver="{minImage.source = TopoGraph.min1}" mouseOut="{minImage.source = TopoGraph.min2}" />
    <s:Image id="plusImage" right="170" depth="{int.MAX_VALUE}" click="topo1.zoomIn()" bottom="40" source="{TopoGraph.plus1}" useHandCursor="true" buttonMode="true"
             mouseOver="{plusImage.source = TopoGraph.plus2}" mouseOut="{plusImage.source = TopoGraph.plus1}" />
    <s:Image id="c" right="120" depth="{int.MAX_VALUE}" bottom="32" source="{TopoGraph.c1}" useHandCursor="true" buttonMode="true"
             mouseOver="{c.source = TopoGraph.c2;c1.source = TopoGraph.c13}" mouseOut="{c.source = TopoGraph.c1;c1.source = TopoGraph.c11}"
             mouseDown="moveGraph(event)"/>
    <s:Image id="c1" right="131 " depth="{int.MAX_VALUE}" bottom="43" source="{TopoGraph.c11}" useHandCursor="true" buttonMode="true"
             mouseOver="{c1.source = TopoGraph.c12}" mouseOut="{c1.source = TopoGraph.c13}" click="topo1.fit()"/>
    
</s:Application>
