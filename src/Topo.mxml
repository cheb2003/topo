<?xml version="1.0"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:topo1="my.ui.topo.*" xmlns:mx="library://ns.adobe.com/flex/mx" creationComplete="fn()"
               preinitialize="pinit()">
    <fx:Script><![CDATA[
		import mx.collections.ArrayCollection;
		import mx.collections.ArrayList;
		
		import my.ui.topo.Link;
		import my.ui.topo.Node;
		import my.ui.topo.data.DataAnalyzer;
		import my.ui.topo.data.TestData;

        import spark.events.IndexChangeEvent;

        [Bindable]
		public var nodes:ArrayCollection = null;
		[Bindable]
		public var links:ArrayCollection = null;
		public var isTest:Boolean = true;
		public function pinit():void
		{
			if (isTest)
			{
				nodes = DataAnalyzer.getNodeList(TestData.testNodeJsonStr);
				links = DataAnalyzer.getLinkList(TestData.testLinkJsonStr,nodes.toArray());
			}else{
				topo1.addNodes("");
			}
		}
        public function fn():void{
           topo1.nodeLayout.performLayout();
        }

        private function moveGraph(event:MouseEvent):void {
            var x:Number = 20 - event.localX
            var y:Number = 20 - event.localY
            if(x < 0) {
                x -= 15 * Math.abs(x/15)
            } else {
                x += 15 * Math.abs(x/15);
            }
            if(y < 0) {
                y -= 15 * Math.abs(y/15)
            } else {
                y += 15 * Math.abs(y/15)
            }
            topo1.moveBy(x, y)
        }

        public function indexChangeHandler(evt:IndexChangeEvent):void{
            if(btnBar.selectedIndex == 0){
                topo1.showCoAuthorGraph();
            }else if(btnBar.selectedIndex == 1){
                topo1.showCoAuthorPath();
            }else if(btnBar.selectedIndex == 2){
                topo1.showCitaionGraph();
            }
        }

        ]]></fx:Script>

    <topo1:TopoGraph id="topo1" nodeDataProvider="{nodes}" linkDataProvider="{links}" backgroundColor="#ffffff"  width="100%" height="100%"/>

    <s:ButtonBar id="btnBar" top="20" left="50" height="30" change="indexChangeHandler(event)" selectedIndex="0">
        <s:ArrayCollection>
            <fx:String>Co-author Graph</fx:String>
            <fx:String>Co-author Path</fx:String>
            <fx:String>Citaion Graph</fx:String>
        </s:ArrayCollection>
    </s:ButtonBar>

    <s:Image id="minImage" right="200" depth="{int.MAX_VALUE}" click="topo1.zoomOut()" bottom="40" source="{TopoGraph.min2}" useHandCursor="true" buttonMode="true"
            mouseOver="{minImage.source = TopoGraph.min1}" mouseOut="{minImage.source = TopoGraph.min2}" />
    <s:Image id="plusImage" right="170" depth="{int.MAX_VALUE}" click="topo1.zoomIn()" bottom="40" source="{TopoGraph.plus1}" useHandCursor="true" buttonMode="true"
             mouseOver="{plusImage.source = TopoGraph.plus2}" mouseOut="{plusImage.source = TopoGraph.plus1}" />
    <s:Image id="c" right="120" depth="{int.MAX_VALUE}" bottom="32" source="{TopoGraph.c1}" useHandCursor="true" buttonMode="true"
             mouseOver="{c.source = TopoGraph.c2;c1.source = TopoGraph.c13}" mouseOut="{c.source = TopoGraph.c1;c1.source = TopoGraph.c11}"
             mouseDown="moveGraph(event)"/>
    <s:Image id="c1" right="131 " depth="{int.MAX_VALUE}" bottom="43" source="{TopoGraph.c11}" useHandCursor="true" buttonMode="true"
             mouseOver="{c1.source = TopoGraph.c12}" mouseOut="{c1.source = TopoGraph.c13}" click="topo1.fit()"/>

</s:Application>
