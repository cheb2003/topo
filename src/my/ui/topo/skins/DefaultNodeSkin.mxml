<?xml version="1.0"?>
<s:SparkSkin contentBackgroundColor="red" creationComplete="init()" xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark" width="80" height="60">
    <fx:Metadata>
        <![CDATA[
        [HostComponent("my.ui.topo.Node")]
        ]]>
    </fx:Metadata>
	<fx:Script>
		<![CDATA[
			import mx.events.EffectEvent;
			import flash.filters.BitmapFilterQuality;
			import flash.filters.BitmapFilterType;
      		private var a1Playing:Boolean;
            private var isMouseOver:Boolean;
            private var isMouseOver1:Boolean;
            private var isInvoke:Boolean;
            private var interval:uint;
			[Bindable]
			private var arr:Array = new Array();
            private function init():void {
				arr.push(glow);
				img.filters = arr;
                img.addEventListener(MouseEvent.ROLL_OVER, rollOverHandler, false, 0, true);
                img.addEventListener(MouseEvent.ROLL_OUT, rollOutHandler, false, 0, true);
            }
            private function rollOutHandler(event:MouseEvent):void {
                if(a1Playing) {
                    if(p1.isPlaying) {
                        p1.reverse()
                        hostComponent.depth = Math.abs(Math.random())
                    }
                    if(p2.isPlaying) {
                        p2.reverse()
                        hostComponent.depth = int.MAX_VALUE
                    }
                    a1Playing = false;
                    return
                }
                if(width > 80 && width <= 120) {
                    p2.play()
                    hostComponent.depth = Math.abs(Math.random());
                }


            }
            private function rollOverHandler(event:MouseEvent):void {

                if(a1Playing) {
                    if(p1.isPlaying) {
                        p1.reverse()
                        hostComponent.depth = Math.abs(Math.random())
                    }
                    if(p2.isPlaying) {
                        p2.reverse()
                        hostComponent.depth = int.MAX_VALUE
                    }
                    a1Playing = false;
                    return
                }
                if(width <= 80) {
                    p1.play();
                    hostComponent.depth = int.MAX_VALUE
                }
            }

			protected function effectEndHandler(event:EffectEvent):void
			{
				if (a1Playing)
				{
					a1Playing = false;
					label.includeInLayout = false;
					label.visible = false;
					bc.includeInLayout = true;
					bc.visible = true;
				}
			}
			
			protected function effectStartHandler(event:EffectEvent):void
			{
				if (!a1Playing)
				{
					a1Playing = true;
					label.includeInLayout = true;
					label.visible = true;
					bc.includeInLayout = false;
					bc.visible = false;
				}
			}
			
		]]>
	</fx:Script>
    <fx:Declarations>
		<s:GradientGlowFilter id="glow" 
				  blurX="30" blurY="30"
				  quality="{BitmapFilterQuality.HIGH}"
				  type="{BitmapFilterType.OUTER}" 
				  
				  knockout="false">
			<s:entries>
				<s:GradientEntry alpha="0" color="0x3333FF" ratio="0"/>
				<s:GradientEntry alpha="0.8" color="0x3333FF" ratio="128"/>
				<s:GradientEntry alpha="0.8" color="0x3333FF" ratio="255"/>
			</s:entries>
		</s:GradientGlowFilter>
        <s:Parallel id="p1">
            <s:Resize target="{this}" id="r1"  widthFrom="{width}" heightFrom="{height}" heightTo="{height + 40}" widthTo="{width + 40}"/>
            <s:Animate id="a1" target="{this}" effectStart="{a1Playing = true}" effectEnd="effectEndHandler(event)">
                <s:SimpleMotionPath property="x" valueFrom="{x}" valueTo="{x - 10}"/>
                <s:SimpleMotionPath property="y" valueFrom="{y}" valueTo="{y - 10}"/>
            </s:Animate>
        </s:Parallel>
        <s:Parallel id="p2">
            <s:Resize target="{this}"  widthFrom="{width}" heightFrom="{height}" heightTo="{height - 40}" widthTo="{width - 40}"/>
            <s:Animate target="{this}" effectStart="effectStartHandler(event)" effectEnd="{a1Playing = false}">
                <s:SimpleMotionPath property="x" valueFrom="{x}" valueTo="{x + 10}"/>
                <s:SimpleMotionPath property="y" valueFrom="{y}" valueTo="{y + 10}"/>
            </s:Animate>
        </s:Parallel>
		
		<s:Move id="nodeTipEffect" target="{bc}" yFrom="{bc.y + 15}" yTo="{bc.y}" duration="300"/>
    </fx:Declarations>

    <s:states>
        <s:State name="normal">
        </s:State>
        <s:State name="selectedAndShowLabel"/>
        <s:State name="selected"/>
        <s:State name="mouseOver"/>
    </s:states>

	<s:Image
		source="{hostComponent.imageSource}" id="img" x="{-img.width/2}" y="{-img.height/2}" width="{this.width}" height="{this.height}"/>
    <s:Label id="label" text="test" x="{img.x}" y="{img.y+img.height+5}" width="{img.width}" textAlign="center" />
	<s:BorderContainer id="bc" visible="false" includeInLayout="false" width="235" height="40" x="{img.x+img.width/2-this.width/2-30}" y="{img.y+img.height}"
			cornerRadius="5" borderWeight="2" dropShadowVisible="false" showEffect="{nodeTipEffect}" color="0x999999">
		<s:Label x="5" y="13" text=">>" color="0x4fBEF1" fontWeight="bold"/>
		<s:Label x="20" y="5" text="Eric S. Lander" color="0x45BEF4" fontSize="14"/>
		<s:Label x="20" y="20" text="Massachusetts Institure of Technology" color="0x000000" fontSize="12"/>
	</s:BorderContainer>

</s:SparkSkin>
